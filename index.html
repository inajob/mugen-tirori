<html>
  <head>
    <title>無限ティロリ</title>
  </head>
  <body>
    <div>
      <a href="https://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="basic-label-counter" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/v4/public/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
    </div>
    <h1>無限ティロリ</h1>
    <button id="btn">start</button>
    <div>sound by https://www.youtube.com/watch?v=8NjhfastLts</div>
    <div><a href="https://github.com/inajob/mugen-tirori">source</a></div>
    <audio id="audio1" src="terori.mp3" type="audio/mpeg"></audio>
    <audio id="audio2" src="terori.mp3" type="audio/mpeg"></audio>
    <audio id="audio3" src="terori.mp3" type="audio/mpeg"></audio>
    <audio id="audio4" src="terori.mp3" type="audio/mpeg"></audio>
    <audio id="audio5" src="terori.mp3" type="audio/mpeg"></audio>
    <script>
    btn.addEventListener("click", () => {
    const audioContext = new AudioContext();
     let audioElements =[] 
     let tracks =[] 
     for(i = 1; i < 5; i ++){
       audioElements[i - 1] = document.querySelector('#audio' + i); 
       audioElements[i - 1].volume = 1/5;
       tracks[i - 1] = audioContext.createMediaElementSource(audioElements[i - 1]);
       tracks[i - 1].connect(audioContext.destination);
       audioElements[i - 1].loop = true;
       audioElements[i - 1].playbackRate = 1;
       audioElements[i - 1].preservesPitch = false;
       audioElements[i - 1].play();
     }
     function clip(n){
             if(n < 0) return 0;
             if(n > 1) return 1;
             return n;
     }

     setInterval(() => {
       for(i = 1; i < 5; i ++){
         if(Math.random() < 0.9){
         audioElements[i - 1].playbackRate = clip(audioElements[i - 1].playbackRate + (Math.random()-0.5)*0.01);
               }else{
         audioElements[i - 1].playbackRate = clip(audioElements[i - 1].playbackRate + (Math.random()-0.5)*0.4);
                     }
       }
     }, 100)

     });
    </script>
  </body>
</html>
